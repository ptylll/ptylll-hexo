---
title: 图片加载优化
date: 2018-09-01 17:33:02
tags: 前端优化
---

在网页加载过程中，图片加载常常需要消耗大量的资源。浏览器在加载网页时遇到图片标签就会依次加载，当页面中有大量的图片时页面体验就非常差。重要一个原因是，当页面加载时下方隐藏的图片也会加载进来，从而造成资源浪费。
<!--more-->
#### 1.图片懒加载
##### 思路：
将页面里所有img属性src属性用data-xx代替，当页面滚动直至此图片出现在可视区域时，用js取到该图片的data-xx的值赋给src

##### 原理
图片距离页面顶端距离 < 浏览器可视化高度 + 浏览器滚动高度
* 图片距离页面顶端距离使用: offsetTop 获取
* 浏览器可视化高度: 
```
let H = window.innerHeight
```
* 浏览器滚动高度
```
let BH = document.documentElement.scrollTop || document.body.scrollTop

```
#### 2.获取页面各种高度获取
```
页可见区域宽： document.body.clientWidth;
网页可见区域高： document.body.clientHeight;
网页可见区域宽： document.body.offsetWidth (包括边线的宽);
网页可见区域高： document.body.offsetHeight (包括边线的宽);
网页正文全文宽： document.body.scrollWidth;
网页正文全文高： document.body.scrollHeight;
网页被卷去的高： document.body.scrollTop;
网页被卷去的左： document.body.scrollLeft;
网页正文部分上： window.screenTop;
网页正文部分左： window.screenLeft;
屏幕分辨率的高： window.screen.height;
屏幕分辨率的宽： window.screen.width;
屏幕可用工作区高度： window.screen.availHeight;

```
#### 4.代码实现

```

<body>
  <ul id="img">
   <li><img src="./1122加载中.png" data-url="https://dummyimage.com/300/08f.png/f11"></li>
    <li><img src="./1122加载中.png" data-url="https://dummyimage.com/300/08f.png/f12"></li>
    <li><img src="./1122加载中.png" data-url="https://dummyimage.com/300/08f.png/f13"></li>
    <li><img src="./1122加载中.png" data-url="https://dummyimage.com/300/08f.png/f14"></li>
    <li><img src="./1122加载中.png" data-url="https://dummyimage.com/300/08f.png/f15"></li>
    <li><img src="./1122加载中.png" data-url="https://dummyimage.com/300/08f.png/f16"></li>
    <li><img src="./1122加载中.png" data-url="https://dummyimage.com/300/08f.png/f17"></li>
    <li><img src="./1122加载中.png" data-url="https://dummyimage.com/300/08f.png/f18"></li>
    <li><img src="./1122加载中.png" data-url="https://dummyimage.com/300/08f.png/f19"></li>
    <li><img src="./1122加载中.png" data-url="https://dummyimage.com/300/08f.png/f20"></li>
    <li><img src="./1122加载中.png" data-url="https://dummyimage.com/300/08f.png/f21"></li>
    <li><img src="./1122加载中.png" data-url="https://dummyimage.com/300/08f.png/f22"></li>
    <li><img src="./1122加载中.png" data-url="https://dummyimage.com/300/08f.png/f23"></li>
    <li><img src="./1122加载中.png" data-url="https://dummyimage.com/300/08f.png/f24"></li>
    <li><img src="./1122加载中.png" data-url="https://dummyimage.com/300/08f.png/f25"></li>
  </ul>
</body>
<script>

  let imgs = document.querySelectorAll('img');
  let len = imgs.length;

  function getTop(e) { //当前元素offset值
    let t = e.offsetTop;
    console.log(e)
    while (e = e.offsetParent) {
      t += e.offsetTop;
    }
    console.log(t)
    return t;
  }

  function lazyload() { //主函数
    let H = window.innerHeight; //可视化窗口高度
    let scrollTop = document.documentElement.scrollTop || document.body.scrollTop; //滚动条高度
    for (let i = 0; i < len; i++) {
      if (H + scrollTop > getTop(imgs[i])) { //当前元素offsetTop小于 滚动高度加上可视化窗口高度
        imgs[i].src = imgs[i].getAttribute('data-url');
      }
    }
  }
  window.onload = window.onscroll = function () {
    lazyload()
  }
</script>

```
