---
title: 图片加载优化
date: 2018-09-01 17:33:02
tags: 前端优化
---

在网页加载过程中，图片加载常常需要消耗大量的资源。浏览器在加载网页时遇到图片标签就会依次加载，当页面中有大量的图片时页面体验就非常差。重要一个原因是，当页面加载时下方隐藏的图片也会加载进来，从而造成资源浪费。
<!--more-->
#### 1.图片懒加载
##### 思路：
将页面里所有img属性src属性用data-xx代替，当页面滚动直至此图片出现在可视区域时，用js取到该图片的data-xx的值赋给src
#### 2.获取页面各种高度获取
```
页可见区域宽： document.body.clientWidth;
网页可见区域高： document.body.clientHeight;
网页可见区域宽： document.body.offsetWidth (包括边线的宽);
网页可见区域高： document.body.offsetHeight (包括边线的宽);
网页正文全文宽： document.body.scrollWidth;
网页正文全文高： document.body.scrollHeight;
网页被卷去的高： document.body.scrollTop;
网页被卷去的左： document.body.scrollLeft;
网页正文部分上： window.screenTop;
网页正文部分左： window.screenLeft;
屏幕分辨率的高： window.screen.height;
屏幕分辨率的宽： window.screen.width;
屏幕可用工作区高度： window.screen.availHeight;

```
#### 3.第一个版本当页面高度小于屏幕可视化高度时（页面不需要滚动）
```

  <ul id="img">
    <li><img src="./1122加载中.png" data-url="https://img-test.wxyundian.cn/0ctfgxn88ped1540211117329"></li>
    <li><img src="./1122加载中.png" data-url="https://img-test.wxyundian.cn/0ctfgxn88ped1540211117329"></li>
    <li><img src="./1122加载中.png" data-url="https://img-test.wxyundian.cn/0ctfgxn88ped1540211117329"></li>
  </ul>

<script>
  window.onload = function () {
    lazyload()
  }
  function lazyload() {
    let contextHeight = document.getElementById('img').offsetHeight; // 获取元素高度
    let availHeight = window.screen.height; //获取屏幕尺寸高度
    console.log(contextHeight)
    console.log(availHeight)
    if (contextHeight < availHeight) { //页面不需要滚动
      let imgs = document.querySelectorAll('#img img')
      let len = imgs.length;
      for (let i = 0; i < len; i++) {
        let url = imgs[i].getAttribute('data-url');
        var img = new Image();
        img.src = url;
        img.onload = (function(e){
          imgs[i].setAttribute('src',img.src)
        })()
        
      }
    }
  }
</script>

```